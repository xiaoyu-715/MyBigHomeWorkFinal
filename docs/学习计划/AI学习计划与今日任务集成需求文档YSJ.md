# AI学习计划与今日任务集成需求文档YSJ

## 文档控制信息

### 基本信息

| 项目 | 内容 |
|------|------|
| 文档名称 | AI学习计划与今日任务集成需求文档 |
| 文档编号 | REQ-2024-001-YSJ |
| 版本号 | v2.0 |
| 创建日期 | 2024-12-17 |
| 最后更新 | 2024-12-17 |
| 文档状态 | 待评审 |
| 密级 | 内部 |

### 责任人

| 角色 | 姓名 | 职责 |
|------|------|------|
| 需求分析师 | 开发团队 | 需求收集与分析 |
| 产品经理 | 产品团队 | 需求审核与确认 |
| 技术负责人 | 技术团队 | 技术可行性评估 |
| 测试负责人 | 测试团队 | 测试用例设计 |

### 变更历史

| 版本 | 日期 | 修改人 | 修改内容 | 审批人 |
|------|------|--------|----------|--------|
| v1.0 | 2024-12-17 | 开发团队 | 初始版本 | - |
| v2.0 | 2024-12-17 | 开发团队 | 增加UML图表、详细用例、业务流程 | 待审批 |

### 审批记录

| 审批角色 | 审批人 | 审批日期 | 审批意见 | 签名 |
|----------|--------|----------|----------|------|
| 产品经理 | - | - | 待审批 | - |
| 技术负责人 | - | - | 待审批 | - |
| 项目经理 | - | - | 待审批 | - |

### 分发列表

| 序号 | 部门/角色 | 接收人 | 分发日期 |
|------|-----------|--------|----------|
| 1 | 开发团队 | 全体开发人员 | 2024-12-17 |
| 2 | 测试团队 | 全体测试人员 | 2024-12-17 |
| 3 | 产品团队 | 产品经理 | 2024-12-17 |
| 4 | 项目管理 | 项目经理 | 2024-12-17 |

---

## 一、项目概述

### 1.1 项目背景

当前AI学习助手能够基于用户对话生成学习计划，但生成的计划与今日任务模块相互独立，用户需要手动将计划内容转化为每日任务。

### 1.2 项目目标

**核心目标**：实现AI生成的学习计划自动转化为今日任务，打通学习计划与任务执行的完整链路。

**具体目标**：
1. AI生成学习计划时，自动提取任务模板并保存到数据库
2. 根据学习计划自动生成每日任务
3. 今日任务页面展示来自AI计划的个性化任务
4. 实现任务完成状态与学习计划进度的双向同步
5. 提供任务编辑、去重、智能推荐等增强功能

### 1.3 项目范围

**包含范围（In Scope）**：
- AI生成学习计划的结构化提取和保存
- 学习计划到今日任务的自动转化
- 今日任务的展示和管理功能
- 任务完成状态与学习计划进度的同步
- 任务去重和智能推荐
- 数据库结构优化和索引设计

**不包含范围（Out of Scope）**：
- 学习计划的AI推荐算法优化（后续版本）
- 任务提醒和通知功能（后续版本）
- 多人协作学习功能（后续版本）
- 学习数据的云端同步（后续版本）
- 学习报告的高级分析功能（后续版本）

### 1.4 干系人分析

| 干系人 | 角色 | 关注点 | 影响程度 | 参与程度 |
|--------|------|--------|----------|----------|
| 英语学习者 | 最终用户 | 学习效率、用户体验 | 高 | 高 |
| 产品经理 | 决策者 | 产品价值、用户满意度 | 高 | 高 |
| 开发团队 | 实施者 | 技术可行性、开发成本 | 高 | 高 |
| 测试团队 | 质量保证 | 功能完整性、系统稳定性 | 中 | 中 |
| 运维团队 | 维护者 | 系统性能、可维护性 | 中 | 低 |

### 1.5 业务价值分析

**定量收益**：
- 用户学习计划执行率提升：预计从30%提升至70%
- 用户日活跃度提升：预计提升25%
- 用户学习时长增加：预计增加40%
- 用户留存率提升：预计提升15%

**定性收益**：
- 提升用户学习体验，减少手动操作
- 增强产品智能化水平，提升竞争力
- 打通学习计划与任务执行链路，形成闭环
- 为后续AI功能扩展奠定基础

**投资回报分析（ROI）**：
- 开发成本：8人天
- 预期收益：用户活跃度提升25%，留存率提升15%
- 投资回报周期：预计3个月

### 1.6 成功标准

| 指标 | 基线值 | 目标值 | 测量方法 |
|------|--------|--------|----------|
| 学习计划执行率 | 30% | 70% | 统计完成任务数/生成任务数 |
| 用户日活跃度 | 基准值 | +25% | 统计日活跃用户数 |
| 任务生成成功率 | - | >95% | 统计成功生成/总生成次数 |
| 系统响应时间 | - | <15秒 | 性能测试 |
| 用户满意度 | - | >4.0/5.0 | 用户调研 |

---

## 二、需求分析

### 2.1 用例图（Use Case Diagram）

```
                    AI学习计划与今日任务集成系统

    +------------------+
    |  英语学习者  |  (主要角色)
    +------------------+
            |
            |---(UC1) 与AI助手对话
            |
            |---(UC2) 生成学习计划
            |       |
            |       +---<<include>>---(UC2.1) 提取结构化计划
            |       |
            |       +---<<include>>---(UC2.2) 保存计划数据
            |       |
            |       +---<<include>>---(UC2.3) 生成今日任务
            |
            |---(UC3) 查看今日任务
            |       |
            |       +---<<extend>>---(UC3.1) 筛选任务
            |       |
            |       +---<<extend>>---(UC3.2) 排序任务
            |
            |---(UC4) 完成任务
            |       |
            |       +---<<include>>---(UC4.1) 更新任务状态
            |       |
            |       +---<<include>>---(UC4.2) 同步计划进度
            |
            |---(UC5) 编辑任务
            |
            +---(UC6) 删除任务

    +------------------+
    |  智谱AI系统  |  (外部系统)
    +------------------+
            |
            +---(UC2.1) 提取结构化计划
```

### 2.2 用户故事

#### 故事1：AI生成学习计划并自动创建任务
**作为** 英语学习者  
**我想要** 与AI助手对话后自动生成学习计划和今日任务  
**以便于** 我可以立即开始执行学习任务

**验收标准**：
- AI对话后点击"生成计划"，系统自动生成结构化学习计划
- 学习计划包含多个阶段，每个阶段包含具体任务
- 系统自动为今天生成可执行的任务
- 任务生成成功后弹窗提示，可直接跳转到今日任务页面

#### 故事2：查看今日任务
**作为** 英语学习者  
**我想要** 在今日任务页面看到来自AI计划的个性化任务  
**以便于** 我知道今天需要完成哪些学习内容

**验收标准**：
- 今日任务页面显示所有活跃计划的今日任务
- 每个任务显示任务内容、预计时长、所属计划
- 任务按优先级或时间排序
- 显示任务完成进度（已完成/总数）

#### 故事3：完成任务并同步进度
**作为** 英语学习者  
**我想要** 完成任务后自动更新学习计划的进度  
**以便于** 我可以看到自己的学习进展

**验收标准**：
- 点击任务的复选框可标记任务完成
- 任务完成状态实时保存到数据库
- 学习计划的进度自动更新
- 完成任务后显示鼓励提示

### 2.3 业务流程图

#### 2.3.1 学习计划生成流程

```
[用户] --> [与AI对话] --> [点击生成计划] --> [显示进度对话框]
    |
    v
[提取对话上下文] --> [构建Prompt] --> [调用智谱AI API]
    |
    v
[解析JSON响应] --> [验证数据完整性]
    |
    +--[验证失败]--> [显示错误提示] --> [结束]
    |
    +--[验证成功]--> [事务开始]
                        |
                        v
                   [保存计划主体] --> [保存学习阶段] --> [保存任务模板]
                        |
                        v
                   [事务提交] --> [生成今日任务]
                        |
                        v
                   [显示成功对话框] --> [用户选择查看任务] --> [跳转今日任务页面]
```

#### 2.3.2 今日任务生成流程

```
[系统触发] --> [检查今日是否已有任务]
    |
    +--[已有任务]--> [直接返回现有任务] --> [结束]
    |
    +--[没有任务]--> [获取当前学习阶段]
                        |
                        v
                   [查询任务模板] --> [遍历任务模板]
                        |
                        v
                   [检查任务重复] --[相似度>80%]--> [跳过该任务]
                        |
                        +--[不重复]--> [克隆任务模板]
                                        |
                                        v
                                   [设置今日日期] --> [保存任务]
                                        |
                                        v
                                   [返回生成的任务列表]
```

### 2.4 活动图（Activity Diagram）

#### 2.4.1 完成任务流程

```
(开始) --> [用户点击任务复选框]
    |
    v
[切换任务完成状态]
    |
    v
<是否完成?>
    |
    +--[是]--> [设置完成时间戳]
    |           |
    |           v
    |      [显示鼓励提示]
    |
    +--[否]--> [清除完成时间戳]
    |
    v
[调用Repository更新任务]
    |
    v
<更新成功?>
    |
    +--[是]--> [通知Adapter刷新UI]
    |           |
    |           v
    |      [更新进度条]
    |           |
    |           v
    |      [同步计划进度]
    |
    +--[否]--> [显示错误提示]
    |
    v
(结束)
```

### 2.5 状态图（State Diagram）

#### 2.5.1 学习计划状态

```
[初始] --> [草稿] : AI生成
    |
    v
[活跃] : 用户确认保存
    |
    +--[暂停]--> [暂停中] --[恢复]--> [活跃]
    |
    +--[完成所有任务]--> [已完成]
    |
    +--[删除]--> [已删除]
    |
    +--[过期]--> [已过期]
```

#### 2.5.2 任务状态

```
[初始] --> [待处理] : 从模板生成
    |
    v
[进行中] : 用户开始执行
    |
    +--[完成]--> [已完成]
    |
    +--[跳过]--> [已跳过]
    |
    +--[删除]--> [已删除]
    |
    +--[过期]--> [已过期]
```

### 2.6 数据流图（Data Flow Diagram）

#### 2.6.1 0层DFD（系统上下文图）

```
[用户] --对话内容--> [AI学习计划系统] --学习计划--> [用户]
                            |
                            +--任务列表--> [用户]
                            |
                            +--进度更新--> [用户]

[智谱AI] --JSON计划--> [AI学习计划系统]

[AI学习计划系统] --计划数据--> [数据库]
[AI学习计划系统] <--任务数据-- [数据库]
```

#### 2.6.2 1层DFD（系统内部数据流）

```
[用户] --对话历史--> [1.0 计划生成] --Prompt--> [智谱AI]
                            |
                            v
                    [D1: 计划数据]
                            |
                            v
                    [2.0 任务生成] <--任务模板-- [D1: 计划数据]
                            |
                            v
                    [D2: 任务数据]
                            |
                            v
[用户] <--任务列表-- [3.0 任务展示] <--任务详情-- [D2: 任务数据]
    |
    v
[4.0 任务管理] --状态更新--> [D2: 任务数据]
    |
    v
[5.0 进度同步] --进度更新--> [D1: 计划数据]
```

---

## 三、功能需求

### 3.1 功能模块概览

```
AI学习计划与今日任务集成系统
├── 学习计划生成模块
│   ├── AI对话分析
│   ├── 结构化计划提取
│   └── 计划数据保存
├── 任务生成模块
│   ├── 任务模板管理
│   ├── 今日任务生成
│   └── 任务去重逻辑
├── 任务展示模块
│   ├── 今日任务列表
│   ├── 任务详情展示
│   └── 任务来源标识
├── 任务管理模块
│   ├── 任务完成标记
│   ├── 任务编辑功能
│   └── 任务删除功能
└── 进度同步模块
    ├── 任务状态同步
    ├── 计划进度更新
    └── 统计数据计算
```

### 3.2 详细功能需求

#### 3.2.1 学习计划生成模块

**功能描述**：用户与AI助手对话后，系统分析对话内容，生成结构化的学习计划。

**输入**：
- 用户与AI的对话历史（最近10条消息）
- 用户点击"生成计划"按钮

**处理逻辑**：
1. 提取对话上下文
2. 构建结构化Prompt，要求AI返回JSON格式的计划
3. 调用智谱AI API生成计划
4. 解析JSON响应，验证数据完整性
5. 将计划、阶段、任务模板保存到数据库（事务操作）

**输出**：
- StructuredPlanResult对象（包含计划、阶段、任务）
- 数据库中的StudyPlanEntity、StudyPhaseEntity、DailyTaskEntity记录
- 成功/失败提示

**性能要求**：
- AI响应时间<10秒
- 数据库保存时间<2秒
- 整体流程<15秒

#### 3.2.2 任务生成模块

**功能描述**：根据学习计划自动生成今日任务。

**输入**：
- 学习计划ID
- 当前日期

**处理逻辑**：
1. 检查今日是否已有任务（幂等性保证）
2. 如果已有任务，直接返回
3. 如果没有任务：
   - 获取当前学习阶段
   - 从任务模板中筛选适合今日的任务
   - 检查任务去重（相似度>80%视为重复）
   - 生成DailyTaskEntity并保存到数据库
4. 返回生成的任务列表

**输出**：
- List<DailyTaskEntity>（今日任务列表）
- 是否为新生成的标识

**去重规则**：
- 计算任务内容的Levenshtein距离
- 相似度>80%视为重复
- 保留最新的任务

**性能要求**：
- 任务生成时间<1秒
- 支持批量生成（多个计划）

#### 3.2.3 任务展示模块

**功能描述**：在今日任务页面展示所有活跃计划的今日任务。

**输入**：
- 当前日期
- 用户ID（如果有多用户）

**处理逻辑**：
1. 查询所有活跃的学习计划
2. 对每个计划，查询今日任务
3. 合并所有任务到一个列表
4. 按优先级或时间排序
5. 显示任务列表

**输出**：
- 任务列表（RecyclerView）
- 每个任务显示：任务图标、任务内容、预计时长、所属计划名称、所属阶段名称、完成状态
- 进度条（已完成/总数）

**UI要求**：
- 任务项高度：80dp
- 完成的任务透明度：60%
- 支持下拉刷新
- 空状态提示："暂无今日任务"

---

## 四、非功能需求

### 4.1 性能需求

| 指标 | 要求 | 测试方法 |
|------|------|----------|
| AI生成计划响应时间 | <10秒 | 压力测试 |
| 任务生成时间 | <1秒 | 单元测试 |
| 任务列表加载时间 | <1秒（100个任务） | 性能测试 |
| 数据库查询时间 | <500ms | SQL分析 |
| UI操作响应时间 | <500ms | 用户体验测试 |

### 4.2 可靠性需求

- **数据一致性**：使用数据库事务保证计划、阶段、任务的一致性
- **幂等性**：任务生成支持幂等操作，避免重复生成
- **错误恢复**：网络请求失败支持重试（最多3次）
- **数据备份**：关键数据变更记录日志

### 4.3 可用性需求

- **易用性**：用户无需手动操作，自动完成计划到任务的转化
- **反馈及时**：所有操作提供即时反馈（Toast、Dialog）
- **错误提示**：错误信息清晰易懂，提供解决建议

### 4.4 可维护性需求

- **代码规范**：遵循Android开发规范
- **注释完整**：关键方法添加注释
- **日志记录**：关键操作记录日志
- **单元测试**：测试覆盖率>80%

---

## 五、数据需求

### 5.1 数据模型

#### 5.1.1 StructuredPlanResult（结构化计划结果）

```java
public class StructuredPlanResult {
    private String title;              // 计划标题
    private String description;        // 计划描述
    private String category;           // 分类
    private String difficulty;         // 难度：beginner/intermediate/advanced
    private int estimatedDays;         // 预计天数
    private Date startDate;            // 开始日期
    private Date endDate;              // 结束日期
    private int totalTasks;            // 总任务数
    private List<Phase> phases;        // 阶段列表
}
```

#### 5.1.2 DailyTaskEntity（每日任务实体）

```java
@Entity(tableName = "daily_tasks")
public class DailyTaskEntity {
    @PrimaryKey(autoGenerate = true)
    private int id;
    private int planId;                // 关联的计划ID
    private int phaseId;               // 关联的阶段ID
    private String date;               // 任务日期（yyyy-MM-dd）
    private String taskContent;        // 任务内容
    private int estimatedMinutes;      // 预计时长
    private int actualMinutes;         // 实际时长
    private boolean isCompleted;       // 是否完成
    private long completedAt;          // 完成时间戳
    private int taskOrder;             // 任务顺序
    private String taskType;           // 任务类型
    private String source;             // 来源：ai_generated/manual
    private String planTitle;          // 关联计划标题
    private String phaseName;          // 关联阶段名称
}
```

### 5.2 数据库设计

**daily_tasks（每日任务表）**

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | 任务ID |
| plan_id | INTEGER | FOREIGN KEY | 计划ID |
| phase_id | INTEGER | FOREIGN KEY | 阶段ID |
| date | TEXT | NOT NULL | 任务日期 |
| task_content | TEXT | NOT NULL | 任务内容 |
| estimated_minutes | INTEGER | | 预计时长 |
| is_completed | INTEGER | DEFAULT 0 | 是否完成 |
| task_type | TEXT | | 任务类型 |
| source | TEXT | DEFAULT 'ai_generated' | 来源 |
| plan_title | TEXT | | 计划标题 |
| phase_name | TEXT | | 阶段名称 |

**索引设计**：
```sql
CREATE INDEX idx_daily_tasks_plan_date ON daily_tasks(plan_id, date);
CREATE INDEX idx_daily_tasks_date ON daily_tasks(date);
```

---

## 六、实施计划

### 6.1 开发阶段

| 阶段 | 任务 | 时间 | 优先级 |
|------|------|------|--------|
| 1 | 数据模型扩展 | 1天 | 高 |
| 2 | 核心功能开发 | 3天 | 高 |
| 3 | 任务模块改造 | 2天 | 高 |
| 4 | 测试与优化 | 2天 | 中 |
| **总计** | | **8天** | |

### 6.2 验收标准

- [ ] AI生成的学习计划能正确保存到数据库
- [ ] 计划保存后自动生成今日任务
- [ ] 今日任务页面正确显示所有活跃计划的任务
- [ ] 任务完成状态能正确更新
- [ ] 无重复任务生成
- [ ] 性能测试通过（100个任务加载<1秒）
- [ ] 单元测试覆盖率>80%

---

## 七、风险与应对

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| AI生成格式不一致 | 高 | 中 | 添加格式验证和容错处理 |
| 数据库性能问题 | 中 | 低 | 添加索引和缓存 |
| 任务重复 | 中 | 中 | 实现智能去重算法 |
| 用户体验不佳 | 高 | 低 | 添加加载提示和错误反馈 |

---

## 八、附录

### 8.1 术语表

| 术语 | 说明 |
|------|------|
| 学习计划 | 用户通过AI助手生成的学习规划 |
| 学习阶段 | 学习计划的子阶段，包含多个任务 |
| 今日任务 | 根据学习计划生成的每日待办任务 |
| 任务模板 | 学习阶段中定义的任务原型 |
| 幂等性 | 多次执行相同操作结果一致 |

### 8.2 参考文档

- Android开发规范
- Room数据库文档
- 智谱AI API文档
- Material Design指南

---

**文档结束**
