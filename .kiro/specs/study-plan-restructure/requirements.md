# 需求文档：学习计划结构化升级

## 简介

本需求文档描述了将学习计划模块从"描述性文字"升级为"结构化可执行任务系统"的功能需求。通过引入学习阶段（Phase）和每日任务（DailyTask）的概念，让AI生成的学习计划具有明确的执行路径，用户可以清晰地知道每天该做什么，并自动追踪学习进度。

## 术语表

- **StudyPlan（学习计划）**: 用户的整体学习计划，包含基本信息和多个学习阶段
- **StudyPhase（学习阶段）**: 学习计划中的一个阶段，如"基础巩固"、"能力提升"、"冲刺强化"
- **DailyTask（每日任务）**: 某一天需要完成的具体学习任务
- **TaskTemplate（任务模板）**: 阶段中定义的每日任务模板，用于生成具体的每日任务
- **智谱AI**: 提供AI对话和学习计划生成能力的API服务

## 需求列表

### 需求1：数据模型升级

**用户故事**: 作为开发者，我希望数据模型支持结构化的学习计划，以便存储阶段和任务信息。

#### 验收标准

1. WHEN 创建学习阶段实体 THEN 系统 SHALL 包含阶段名称、阶段顺序、阶段目标、持续天数、完成状态等字段
2. WHEN 创建每日任务实体 THEN 系统 SHALL 包含任务内容、预计时长、实际时长、完成状态、完成时间等字段
3. WHEN 学习计划与阶段关联 THEN 系统 SHALL 支持一个计划包含多个阶段的一对多关系
4. WHEN 阶段与任务关联 THEN 系统 SHALL 支持一个阶段包含多个任务的一对多关系
5. WHEN 数据库版本升级 THEN 系统 SHALL 执行数据迁移保留现有数据

### 需求2：AI生成结构化学习计划

**用户故事**: 作为用户，我希望AI生成的学习计划包含明确的阶段划分和每日任务，以便我知道每天该做什么。

#### 验收标准

1. WHEN AI生成学习计划 THEN 系统 SHALL 返回包含phases数组的结构化JSON数据
2. WHEN 解析AI响应 THEN 系统 SHALL 正确提取阶段名称、目标、持续天数和每日任务模板
3. WHEN AI生成失败 THEN 系统 SHALL 显示友好的错误提示并支持重试
4. WHEN 用户预览计划 THEN 系统 SHALL 显示所有阶段和任务的预览信息
5. WHEN 保存计划 THEN 系统 SHALL 同时保存计划、阶段和任务模板到数据库

### 需求3：学习计划详情页

**用户故事**: 作为用户，我希望查看学习计划的详细信息，包括当前阶段、今日任务和整体进度。

#### 验收标准

1. WHEN 打开计划详情页 THEN 系统 SHALL 显示计划概览信息（总进度、连续学习天数）
2. WHEN 显示今日任务 THEN 系统 SHALL 列出当天需要完成的所有任务及其状态
3. WHEN 显示学习阶段 THEN 系统 SHALL 展示所有阶段及其完成状态（已完成/进行中/未开始）
4. WHEN 任务列表为空 THEN 系统 SHALL 显示"今日无任务"的友好提示
5. WHEN 计划已完成 THEN 系统 SHALL 显示完成祝贺信息和学习统计

### 需求4：每日任务执行

**用户故事**: 作为用户，我希望能够标记每日任务的完成状态，以便追踪我的学习进度。

#### 验收标准

1. WHEN 用户点击任务复选框 THEN 系统 SHALL 切换任务的完成状态
2. WHEN 任务标记为完成 THEN 系统 SHALL 记录完成时间并更新数据库
3. WHEN 所有今日任务完成 THEN 系统 SHALL 显示"今日学习完成"的鼓励提示
4. WHEN 今日任务全部完成 THEN 系统 SHALL 自动更新计划进度和阶段进度
5. WHEN 用户取消任务完成 THEN 系统 SHALL 清除完成时间并更新进度

### 需求5：进度自动计算

**用户故事**: 作为用户，我希望学习进度能够根据任务完成情况自动计算，以便准确反映我的学习状态。

#### 验收标准

1. WHEN 任务完成状态变化 THEN 系统 SHALL 自动重新计算阶段进度百分比
2. WHEN 阶段进度变化 THEN 系统 SHALL 自动重新计算计划总进度百分比
3. WHEN 阶段所有任务完成 THEN 系统 SHALL 自动将阶段标记为已完成
4. WHEN 所有阶段完成 THEN 系统 SHALL 自动将计划标记为已完成
5. WHEN 计算进度 THEN 系统 SHALL 基于已完成天数占总天数的比例计算

### 需求6：每日任务自动生成

**用户故事**: 作为用户，我希望系统能够根据任务模板自动生成每天的具体任务，以便我不需要手动创建。

#### 验收标准

1. WHEN 用户开始学习计划 THEN 系统 SHALL 根据当前阶段的任务模板生成今日任务
2. WHEN 进入新的一天 THEN 系统 SHALL 自动检查并生成当天的任务
3. WHEN 阶段切换 THEN 系统 SHALL 使用新阶段的任务模板生成任务
4. WHEN 任务已存在 THEN 系统 SHALL 跳过生成避免重复
5. WHEN 计划暂停 THEN 系统 SHALL 停止生成新任务

### 需求7：计划列表卡片优化

**用户故事**: 作为用户，我希望在计划列表中快速了解每个计划的当前状态和今日任务情况。

#### 验收标准

1. WHEN 显示计划卡片 THEN 系统 SHALL 展示当前所处阶段名称
2. WHEN 显示计划卡片 THEN 系统 SHALL 展示今日任务完成情况（如：2/3已完成）
3. WHEN 显示计划卡片 THEN 系统 SHALL 展示剩余天数
4. WHEN 计划有今日任务未完成 THEN 系统 SHALL 突出显示提醒用户
5. WHEN 点击计划卡片 THEN 系统 SHALL 跳转到计划详情页

### 需求8：UI风格统一

**用户故事**: 作为用户，我希望学习计划模块的界面简洁清新美观，与应用整体风格一致。

#### 验收标准

1. WHEN 设计UI组件 THEN 系统 SHALL 使用简洁清新的配色方案（浅色背景、柔和的强调色）
2. WHEN 显示进度 THEN 系统 SHALL 使用圆角进度条和清晰的百分比显示
3. WHEN 显示任务列表 THEN 系统 SHALL 使用圆角复选框和适当的间距
4. WHEN 显示阶段状态 THEN 系统 SHALL 使用直观的图标区分不同状态
5. WHEN 页面切换 THEN 系统 SHALL 使用平滑的过渡动画

### 需求9：学习数据统计

**用户故事**: 作为用户，我希望能够查看我的学习统计数据，以便了解自己的学习情况。

#### 验收标准

1. WHEN 显示学习概览 THEN 系统 SHALL 展示连续学习天数
2. WHEN 显示学习概览 THEN 系统 SHALL 展示本周学习时长
3. WHEN 显示学习概览 THEN 系统 SHALL 展示已完成任务数量
4. WHEN 完成每日任务 THEN 系统 SHALL 累计学习时长到统计数据
5. WHEN 连续学习中断 THEN 系统 SHALL 重置连续学习天数计数
